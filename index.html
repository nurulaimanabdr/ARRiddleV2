<!DOCTYPE html>
<html>
  <head>
    <title>AR Riddle Game - Enhanced</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin:0; overflow:hidden; font-family:sans-serif; }
      #instruction {
        position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
        color: #fff; font-size: 4vw; background: rgba(0,0,0,0.6);
        padding: 10px 15px; border-radius: 8px; max-width: 90%;
        text-align: center; z-index: 1;
      }
      @media (min-width: 600px) { #instruction { font-size: 18px; } }
      @media (min-width: 1024px) { #instruction { font-size: 22px; } }
      #scoreDisplay, #timerDisplay {
        position: absolute; color: white; font-size: 20px; background: rgba(0,0,0,0.5); border-radius: 10px;
      }
      #scoreDisplay { top: 10px; left: 50%; transform: translateX(-50%); padding: 10px 20px; }
      #timerDisplay { top: 10px; right: 10px; padding: 10px 15px; }
      #startBtn, #restartBtn {
        position: absolute; top: 60%; left: 50%; transform: translateX(-50%);
        font-size: 20px; padding: 10px 20px; background: #28a745;
        color: white; border: none; border-radius: 10px; z-index: 3; cursor: pointer;
      }
      #restartBtn { background:#007bff; display:none; }
      #arjsDebugUIContainer { display:none !important; }
    </style>
  </head>
  <body>
    <div id="instruction">
      ðŸ‘‹ Welcome to the AR Riddle Game!<br>
      Look at the marker to play.<br>
      Gaze (or tap) to answer. Try to score 10 out of 10!
    </div>
    <button id="startBtn">Start Game</button>
    <button id="restartBtn">Play Again</button>
    <div id="scoreDisplay" style="display:none;">Score: 0</div>
    <div id="timerDisplay" style="display:none;">Timer: 10</div>
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <a-entity id="riddleContainer" position="0 0.5 0">
          <a-text id="riddleText" value="" color="#FFFFFF" align="center" width="2.5" position="0 0.6 0" scale="2 2 1"></a-text>
          <a-box id="option1" class="clickable" position="-0.8 0 0" depth="0.1" height="0.3" width="0.7" color="#AAAAAA"></a-box>
          <a-text id="text1" value="" color="#000000" align="center" width="1.5" position="-0.8 0 0.06" scale="1.4 1.4 1"></a-text>
          <a-box id="option2" class="clickable" position="0 0 0" depth="0.1" height="0.3" width="0.7" color="#AAAAAA"></a-box>
          <a-text id="text2" value="" color="#000000" align="center" width="1.5" position="0 0 0.06" scale="1.4 1.4 1"></a-text>
          <a-box id="option3" class="clickable" position="0.8 0 0" depth="0.1" height="0.3" width="0.7" color="#AAAAAA"></a-box>
          <a-text id="text3" value="" color="#000000" align="center" width="1.5" position="0.8 0 0.06" scale="1.4 1.4 1"></a-text>
        </a-entity>
      </a-marker>
      <a-entity camera>
        <a-cursor fuse="true" fuse-timeout="700" raycaster="objects: .clickable" material="color: yellow; shader: flat"></a-cursor>
      </a-entity>
    </a-scene>
    <audio id="correctSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_ebfccdff5b.mp3"></audio>
    <audio id="wrongSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_f0d82c871d.mp3"></audio>
    <script>
      // --- NEW RIDDLE SETS ---
      const set5 = [
        { question: "What has a head and a tail but no body?", answers: ["Snake", "Coin", "Worm"], correct: 1 },
        { question: "I have branches, but no fruit, trunk or leaves. What am I?", answers: ["Bank", "River", "Mountain"], correct: 0 },
        { question: "What canâ€™t talk but will reply when spoken to?", answers: ["Echo", "Shadow", "Ghost"], correct: 0 },
        { question: "Iâ€™m found in socks, scarves and mittens; and often in the paws of playful kittens. What am I?", answers: ["Cotton", "Wool", "Yarn"], correct: 2 },
        { question: "What is always in front of you but canâ€™t be seen?", answers: ["Air", "The Future", "Mirror"], correct: 1 },
      ];
      const set6 = [
        { question: "What comes down but never goes up?", answers: ["Rain", "Smoke", "Balloon"], correct: 0 },
        { question: "What is so fragile that saying its name breaks it?", answers: ["Silence", "Glass", "Secret"], correct: 0 },
        { question: "People buy me to eat, but never eat me. What am I?", answers: ["Plate", "Teeth", "Comb"], correct: 0 },
        { question: "The more of this there is, the less you see. What is it?", answers: ["Fog", "Shadow", "Darkness"], correct: 2 },
        { question: "What can you hold without ever touching or using your hands?", answers: ["Breath", "Promise", "Glance"], correct: 0 },
      ];

      // --- ALL RIDDLES ---
      const allSets = [
        // Original 4 sets (from your code) and the 2 new ones
        [
          { question: "What has to be broken before you can use it?", answers: ["Egg", "Glass", "Box"], correct: 0 },
          { question: "What goes up but never comes down?", answers: ["Smoke", "Balloon", "Age"], correct: 2 },
          { question: "The more you take, the more you leave behind. What are they?", answers: ["Footsteps", "Memories", "Holes"], correct: 0 },
          { question: "Iâ€™m tall when Iâ€™m young, and Iâ€™m short when Iâ€™m old. What am I?", answers: ["Candle", "Tree", "Human"], correct: 0 },
          { question: "What has hands but canâ€™t clap?", answers: ["Clock", "Robot", "Ghost"], correct: 0 }
        ], [
          { question: "What can you catch but not throw?", answers: ["Ball", "Cold", "Shadow"], correct: 1 },
          { question: "What gets wetter the more it dries?", answers: ["Towel", "Water", "Sun"], correct: 0 },
          { question: "What has a neck but no head?", answers: ["Shirt", "Bottle", "Snake"], correct: 1 },
          { question: "I speak without a mouth... What am I?", answers: ["Shadow", "Echo", "Wind"], correct: 1 },
          { question: "What comes once in a minute, twice in a moment, but never in a thousand years?", answers: ["Time", "The letter M", "Wind"], correct: 1 }
        ], [
          { question: "What has many keys but can't open a single lock?", answers: ["Piano", "Keyboard", "Map"], correct: 0 },
          { question: "What has one eye but canâ€™t see?", answers: ["Needle", "Storm", "Bat"], correct: 0 },
          { question: "What begins with T, ends with T, and has T in it?", answers: ["Teapot", "Tent", "Toilet"], correct: 0 },
          { question: "What kind of band never plays music?", answers: ["Wristband", "Rubber Band", "Headband"], correct: 1 },
          { question: "What is full of holes but still holds water?", answers: ["Net", "Sponge", "Strainer"], correct: 1 }
        ], [
          { question: "What goes around the world but stays in a corner?", answers: ["Stamp", "Compass", "Map"], correct: 0 },
          { question: "What invention lets you look right through a wall?", answers: ["Window", "Mirror", "Glasses"], correct: 0 },
          { question: "What can fill a room but takes up no space?", answers: ["Air", "Light", "Sound"], correct: 1 },
          { question: "What can travel around the world while staying in the same corner?", answers: ["Stamp", "Satellite", "Compass"], correct: 0 },
          { question: "What runs, but never walks?", answers: ["Water", "Clock", "River"], correct: 2 }
        ], set5, set6
      ];

      // --- CORE GAME STATE ---
      let riddles = []; // will be selected/shuffled on game start
      let score = 0;
      let current = 0;
      let timer;
      let timeLeft = 10;
      let answered = false;

      // --- DOM REFS ---
      const riddleText = document.getElementById("riddleText");
      const optionBoxes = ["option1", "option2", "option3"].map(id => document.getElementById(id));
      const optionTexts = ["text1", "text2", "text3"].map(id => document.getElementById(id));
      const scoreDisplay = document.getElementById("scoreDisplay");
      const timerDisplay = document.getElementById("timerDisplay");
      const startBtn = document.getElementById("startBtn");
      const restartBtn = document.getElementById("restartBtn");
      const correctSound = document.getElementById("correctSound");
      const wrongSound = document.getElementById("wrongSound");

      // --- GAME SETUP ---
      startBtn.addEventListener("click", startGame);
      restartBtn.addEventListener("click", () => { restartBtn.style.display = "none"; startGame(); });

      function startGame() {
        // Randomly pick 2 unique sets, combine them, and shuffle to get 10
        let sets = [...allSets];
        sets.sort(()=>0.5-Math.random());
        riddles = [...sets[0], ...sets[1]].sort(()=>0.5-Math.random());
        score = 0; current = 0; answered = false;
        scoreDisplay.textContent = "Score: 0";
        scoreDisplay.style.display = "block";
        timerDisplay.style.display = "block";
        startBtn.style.display = "none";
        restartBtn.style.display = "none";
        loadRiddle(0);
      }

      function loadRiddle(index) {
        const r = riddles[index];
        riddleText.setAttribute("value", r.question);
        optionBoxes.forEach((box,i) => {
          box.setAttribute("color", "#AAAAAA");
          box.setAttribute("visible", true);
          box.setAttribute("opacity", 1);
          optionTexts[i].setAttribute("value", r.answers[i]);
          optionTexts[i].setAttribute("visible", true);
        });
        answered = false;
        resetTimer();
      }

      function resetTimer() {
        timeLeft = 10;
        timerDisplay.textContent = "Timer: 10";
        clearInterval(timer);
        timer = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = "Timer: " + timeLeft;
          if (timeLeft === 0) {
            clearInterval(timer);
            handleAnswer(-1);
          }
        }, 1000);
      }

      function setOptionsDimmed(dim) {
        optionBoxes.forEach(box =>
          box.setAttribute("opacity", dim ? 0.6 : 1)
        );
        optionTexts.forEach(txt =>
          txt.setAttribute("color", dim ? "#666666" : "#000000")
        );
      }

      function handleAnswer(index) {
        if (answered) return;
        answered = true;
        clearInterval(timer);
        setOptionsDimmed(true);

        const correct = riddles[current].correct;
        if (index === correct) {
          score++;
          correctSound.play();
          if (index >= 0)
            optionBoxes[index].setAttribute("color", "#38F716");
        } else {
          wrongSound.play();
          if (index >= 0)
            optionBoxes[index].setAttribute("color", "#FE3E19");
          optionBoxes[correct].setAttribute("color", "#38F716");
        }
        // Reveal feedback instantly
        scoreDisplay.textContent = `Score: ${score}`;

        setTimeout(() => {
          setOptionsDimmed(false);
          current++;
          if (current < riddles.length) {
            loadRiddle(current);
          } else {
            showWinner();
          }
        }, 1400);
      }

      function showWinner() {
        riddleText.setAttribute("value", `ðŸŽ‰ Game Over! Final score: ${score} / ${riddles.length}`);
        optionBoxes.forEach(box => box.setAttribute("visible", false));
        optionTexts.forEach(text => text.setAttribute("visible", false));
        timerDisplay.style.display = "none";
        restartBtn.style.display = "block";
      }

      // --- PREVENT DOUBLE ANSWER ---
      optionBoxes.forEach((box, i) => {
        box.addEventListener("click", () => { if (!answered) handleAnswer(i); });
        // Also listen for "fuse" on VR cursor (on mobile click + AR gaze)
        box.addEventListener("mouseenter", () => {
          if (!answered) box.setAttribute("opacity",0.95); // subtle highlight
        });
        box.addEventListener("mouseleave", () => {
          if (!answered) box.setAttribute("opacity",1);
        });
      });

    </script>
  </body>
</html>
